include:
  - wazuh-docker/single-node/docker-compose.yml

services:
  setup-wazuh:
    build: setup-wazuh
    environment:
      - WAZUH_MANAGER=wazuh.manager
      - WAZUH_API_USER=wazuh-wui
      - WAZUH_API_PASSWORD=MyS3cr37P450r.*-
      - WAZUH_INDEXER=wazuh.indexer
      - WAZUH_INDEXER_USER=admin
      - WAZUH_INDEXER_PASSWORD=SecretPassword

  web-app-with-wazuh:
    build:
      context: web-application-with-wazuh
      args:
      - WAZUH_MANAGER=wazuh.manager
      - WAZUH_AGENT_NAME=agente47-webserver-wazuh
    cap_add:
      - NET_ADMIN
      - NET_RAW
    ports:
      - 80:80
    depends_on:
      setup-wazuh:
        condition: service_completed_successfully

  honeypot:
    build: honeypot
    environment:
      - WAZUH_MANAGER=wazuh.manager
    depends_on:
      setup-wazuh:
        condition: service_completed_successfully
    # Non esponiamo porte: accediamo direttamente
    # all'IP del container, cos√¨ possiamo farlo
    # ascoltare su tutte le porte che vogliamo
    # senza conflitti (80, 443, etc.).
    # L'IP ci viene stampato dall'entrypoint
    # all'avvio del container.

  test-services:
    build: test
    environment:
      - HONEYPOT=honeypot
      - WEBAPP=web-app-with-wazuh
    depends_on:
      - honeypot
      - web-app-with-wazuh
